<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>ğŸ’Š Pill Identifier</title>
    <style>
      body {
        font-family: "Segoe UI", sans-serif;
        background: linear-gradient(135deg, #fcc6bb, #ffdcb8, #f2c5d0);
        margin: 0;
        padding: 2rem;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      h1 {
        color: #333;
        margin-bottom: 1rem;
      }

      form {
        background: white;
        padding: 2rem;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        max-width: 500px;
        width: 100%;
      }

      label {
        display: block;
        margin-top: 1rem;
        font-weight: bold;
        color: #444;
      }

      input[type="text"],
      input[type="file"] {
        width: 100%;
        padding: 0.75rem;
        margin-top: 0.5rem;
        border-radius: 8px;
        border: 1px solid #ccc;
      }

      button[type="submit"],
      .schedule-button {
        margin-top: 1.5rem;
        padding: 0.75rem 1.5rem;
        font-size: 1rem;
        border: none;
        border-radius: 8px;
        background-color: #ffb5a7;
        color: white;
        cursor: pointer;
        transition: background-color 0.3s ease;
      }

      button[type="submit"]:hover,
      .schedule-button:hover {
        background-color: #f28579;
      }

      h2 {
        margin-top: 2rem;
        color: #333;
      }

      img {
        margin-top: 1rem;
        max-width: 200px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.15);
      }

      .result-box {
        background: white;
        margin-top: 2rem;
        padding: 1.5rem;
        border-radius: 12px;
        max-width: 500px;
        width: 100%;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      }

      .final-decision {
        font-weight: bold;
        color: #2c3e50;
        margin-top: 1rem;
      }
    </style>
  </head>
  <body>
    <h1>ğŸ”¬ Pill Identifier</h1>

    <form method="POST" enctype="multipart/form-data">
      <label for="expected_name"
        ><strong>ğŸ“ Expected Medicine Name:</strong></label
      >
      <input
        type="text"
        id="expected_name"
        name="expected_name"
        placeholder="e.g., IP204 or Apo 500"
        required
      />

      <label>Select a pill image:</label>
      <input type="file" name="image" accept="image/*" required />

      <button type="submit">Identify Pill</button>
    </form>

    {% if result %}
    <div class="result-box">
      <h2>ğŸ” Results:</h2>

      {% if result.ocr_confidence >= 40 %}
      <p><strong>ğŸ§¾ OCR Text:</strong> {{ result.ocr_text }}</p>
      <p><strong>ğŸ“Š OCR Confidence:</strong> {{ result.ocr_confidence }}%</p>
      <p class="final-decision">âœ… Final Decision: {{ result.decision }}</p>

      {% elif result.image_matches|length > 0 and
      result.image_matches[0][1]|float >= 80 %}
      <p><strong>ğŸ§  OCR was unclear.</strong></p>
      <p>
        <strong>ğŸ“¸ Best Image Match:</strong> {{ result.image_matches[0][0] }}
        ({{ result.image_matches[0][1] }}%)
      </p>
      <p class="final-decision">âœ… Final Decision: {{ result.decision }}</p>

      {% else %}
      <p>
        <strong
          >âš ï¸ OCR and image matching both failed to confidently identify the
          pill.</strong
        >
      </p>
      <p><strong>ğŸ§¾ OCR Result:</strong> {{ result.ocr_text }}</p>
      <p><strong>ğŸ“Š OCR Confidence:</strong> {{ result.ocr_confidence }}%</p>
      {% if result.image_matches|length > 0 %}
      <p>
        <strong>ğŸ’Š Closest Image Match:</strong> {{ result.image_matches[0][0]
        }} ({{ result.image_matches[0][1] }}%)
      </p>
      {% else %}
      <p><strong>ğŸ’Š No image match found.</strong></p>
      {% endif %}
      <p class="final-decision">ğŸ”´ Final Decision: {{ result.decision }}</p>
      {% endif %}

      <img src="{{ image_path }}" alt="Uploaded Pill" />
      <form action="{{ url_for('pill.schedule_form') }}" method="GET">
        <input
          type="hidden"
          name="medicine_name"
          value="{{ result.ocr_text or result.image_matches[0][0] }}"
        />
        <button type="submit" class="schedule-button">
          â• Add to Schedule
        </button>
      </form>
    </div>
    {% endif %}
  </body>
</html>
