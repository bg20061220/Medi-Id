<!-- templates/index.html -->

<!DOCTYPE html>
<html>
  <head>
    <title>Medi-ID: Pill Identifier</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 2rem;
      }
      img {
        max-width: 300px;
        margin-top: 1rem;
      }
      .result-box {
        border: 1px solid #ccc;
        padding: 1rem;
        margin-top: 1rem;
      }
    </style>
  </head>
  <body>
    <h1>ğŸ’Š Medi-ID: Pill Identifier</h1>
    <form method="POST" enctype="multipart/form-data">
      <label for="expected_name"
        ><strong>ğŸ“ Expected Medicine Name:</strong></label
      >
      <input
        type="text"
        id="expected_name"
        name="expected_name"
        placeholder="e.g., IP204 or Apo 500"
        required
      />
      <label>Select a pill image:</label>
      <input type="file" name="image" accept="image/*" required />
      <button type="submit">Identify Pill</button>
    </form>

    {% if result %}
    <h2>ğŸ” Results:</h2>

    {% if result.ocr_confidence >= 40 %}
    <p><strong>ğŸ§¾ OCR Text:</strong> {{ result.ocr_text }}</p>
    <p><strong>ğŸ“Š OCR Confidence:</strong> {{ result.ocr_confidence }}%</p>
    <p><strong>âœ… Final Decision:</strong> {{ result.decision }}</p>

    {% elif result.image_matches and result.image_matches[0][1]|float >= 80 %}
    <p><strong>ğŸ§  OCR was unclear.</strong></p>
    <p>
      <strong>ğŸ“¸ Best Image Match:</strong> {{ result.image_matches[0][0] }} ({{
      result.image_matches[0][1] }}%)
    </p>
    <p><strong>âœ… Final Decision:</strong> {{ result.decision }}</p>
    <!-- Optional: show uploaded image and/or match pill image if available -->

    {% else %}
    <p>
      <strong
        >âš ï¸ OCR and image matching both failed to confidently identify the
        pill.</strong
      >
    </p>
    <p><strong>ğŸ§¾ OCR Result:</strong> {{ result.ocr_text }}</p>
    <p><strong>ğŸ“Š OCR Confidence:</strong> {{ result.ocr_confidence }}%</p>
    <p>
      <strong>ğŸ’Š Closest Image Match:</strong> {{ result.image_matches[0][0] }}
      ({{ result.image_matches[0][1] }}%)
    </p>
    <p><strong>ğŸ”´ Final Decision:</strong> {{ result.decision }}</p>
    {% endif %}

    <br />
    <img src="{{ image_path }}" alt="Uploaded Pill" width="200" />

    {% endif %}
  </body>
</html>
